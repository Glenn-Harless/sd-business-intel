# Phase 2.5: Momentum Score, Deep Civic Context, Energy & Business Age — Design

**Goal:** Transform neighborhood profiles from static snapshots into dynamic intelligence — momentum scoring, granular civic context, energy benchmarks, and business maturity analysis.

**Architecture:** Layered build matching Phase 2 pattern. Ingest new sibling data, compute derived aggregations, extend query layer, surface in dashboard. No new tabs — everything integrates into existing profile and rankings views.

---

## 1. New Data Ingestion

| Source | File | Target | Key Columns | Rows |
|--------|------|--------|-------------|------|
| sd-get-it-done | `top_problem_types.parquet` | `civic_311_services.parquet` | service_name, total_requests, median_resolution_days, close_rate_pct | ~47 |
| sd-housing-permits | `approval_timelines.parquet` | `civic_permit_timelines.parquet` | year, approval_type_clean, zip_code, permit_count, median_days | ~2,483 |
| sd-climate-action | `energy_by_zip_annual.parquet` | `civic_energy.parquet` | zip_code, year, total_kwh, elec_customers, avg_kwh_per_customer | ~1,638 |

Crime already ingested with 3-category zip-level breakdown (Person/Property/Society). No new ingestion needed.

## 2. Pipeline Aggregation

**`business_age_stats.parquet`** (~1,200 rows)
- From `businesses.parquet`: `DATEDIFF('day', start_date, CURRENT_DATE)` for 51K active businesses
- Grouped by zip_code + category
- Columns: zip_code, category, business_count, median_age_years, avg_age_years, pct_under_2yr, pct_over_10yr

**`business_age_by_area.parquet`** (~500 rows)
- Same but grouped by area + category

**`momentum_scores.parquet`** (~82 rows)
- YoY % change for latest full year (2025 vs 2024) across 4 metrics:
  - biz_formation_yoy, permit_yoy, crime_yoy (inverted), solar_yoy
- Each normalized to 0-25 range, summed to 0-100 composite score
- Columns: zip_code, momentum_score, biz_formation_yoy, permit_yoy, crime_yoy, solar_yoy

**`momentum_by_area.parquet`** (~24 rows)
- Population-weighted average of zip momentum scores

## 3. Query Layer + API + MCP

**5 new query functions:** get_momentum_scores, get_area_momentum, get_business_age, get_area_business_age, get_311_services

**4 modified functions:** get_neighborhood_profile and get_area_profile gain crime breakdown, energy benchmark, permit approval speed, momentum score. Rankings functions gain momentum_score as sortable metric.

**5 new API endpoints + 5 new MCP tools** mirroring the query functions.

**Narrative updates:** Momentum sentence + business age sentence added to profile narratives.

## 4. Dashboard

All integrated into existing views (no new tabs):
- Crime breakdown bar chart (Person/Property/Society) in profiles
- Energy avg kWh/customer metric card in civic signals
- Permit approval speed (median days, top 3 types) in civic signals
- Momentum score metric card (0-100, color coded) with expandable breakdown
- Business age section (top 5 categories with median age, emerging/established labels)
- Momentum as sortable metric in rankings
- 311 service types as expandable city-wide reference panel

## Decisions

- Business lifespan → replaced with business age analysis (only 38 inactive records in dataset)
- Crime types → 3-category zip-level (Person/Property/Society), city-wide 36-type as reference
- Momentum → single 0-100 composite score with component breakdown
- Energy → benchmark metric in profiles, not a trend chart
- Approach → layered build (ingest → aggregate → query → dashboard)
